<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
	    <meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	    <title>涂才百科</title>
	    <link rel="stylesheet" href="../../static/css/mui.min.css">
	    <link rel="stylesheet" href="../../static/css/public.css">
	    <link rel="stylesheet" href="../../static/fonts/iconfont.css">
	    <link rel="stylesheet" href="../../static/css/iconfont.css">
	    <link rel="stylesheet" href="../../static/css/commomCss/wiki.css">
	</head>
	<body>	
		<div id="app">
	    <header class="titleBar">
	        <a class="write-barLeft br mui-action-back">取消</a>
	        <p class="barTxt">涂才百科</p>
	        <p class="barRight" >
	            <a class="br" @click="commit()">提交</a>
	        </p>
	    </header>
	    <div style="height:100%;overflow-y: auto">
	    	<div class="writeTop">
	    		<!--<div class="writeTitle">标题</div>-->
	    		<input type="text" class="articleTitle" value="" placeholder="标题" />
	    	</div>
	    	
	    	<div class="writeContent">
		    	<!--<div class="contentTitle">内容</div>-->	
		    	<textarea class="articleContent" placeholder="内容"></textarea>
		    	<!--<div class="uploadImg"><i class="iconfont">&#xe737;</i></div>-->
		    	<div class="uploadImg" onclick="uploadImg()"></div>	
	    	</div>
	    	
	    	<div class="chooseIndustry">
	    		<div class="industryTop">选择行业</div>
		    	<div class="industrys" >
		    		<div v-for="(category,index) in categoryLists" :id="category.c_id"><div class="industry" v-bind:class="{'industryActive':index==selected }" @click="selectBtn(index,category.c_id)">{{category.c_name}}</div></div>
		    		<!--<div><div class="industry">工业涂料</div></div>
		    		<div><div class="industry">粉末涂料</div></div>
		    	</div>	
		    	<div class="industrys">
		    		<!--<div><div class="industry">水性油墨</div></div>
		    		<div><div class="industry">防水涂料</div></div>
		    		<div><div class="industry">粘合剂</div></div>-->
		    	</div>	
	    	</div>
	    	
	    </div>
	    </div>
	</body>
	<script src="../../static/js/jquery.js"></script>
	<script src="../../static/js/flexible.js"></script>
	<script src="../../static/js/mui.min.js"></script>
	<script src="../../static/js/api.js"></script> 
	<script src="../../static/js/vue.min.js"></script>
	<script src="../../static/js/webapp.js"></script>
	
	<script>
		var uid = uid();
		var categoryLists = '';
		var selected = '';
		var typeId = '';
		var categoryvue = new Vue({
			el: '#app',
			data: {
				categoryLists: categoryLists,
				selected: '',
				typeId: typeId
			},
			methods: {
			  	selectBtn: function(index,typeId){
			  		this.selected = index;
			  		this.typeId = typeId;
			  	},
			  	commit: function() {			  	
					var articleTitle = $(".articleTitle").val();
					var articleContent = $(".articleContent").val();
					var smallImg = '';
					var commitParmas = {
						uid: uid,
						title: articleTitle,
						content: articleContent,
						small_img: smallImg, 
						type_id: this.typeId
					};
					var commitUrl = host + 'c=tcbk&a=pubTcbk';
					ajaxRun(commitUrl,commitParmas,true,'GET',function (data) {
						if(data.statuscode==1) {
							location.href='index.html';
							// mui.openWindow({//目标页面 
				            //     url: 'index.html', 
				            //     id: 'index.html'
				            // });
						} else {
							rzState=0;
							console.log(data.msg);	
							mui.toast(data.msg,{ duration:1000}); 
						}
				 	});
				}
			}
		})
		
		var parmas = {};
		var categoryListUrl = host + 'c=tcbk&a=getCategory';
		ajaxRun(categoryListUrl,parmas,true,'GET',function (data) {					
			if(data.statuscode==1){
				categoryvue._data.categoryLists = data.result;
				categoryvue._data.typeId = data.result[0].c_id;
				console.log(categoryvue._data.typeId)
			}else{
				rzState=0;
				console.log(data.msg);	
				mui.toast(data.msg,{ duration:1000}); 
			}					
									
	 	});			
		
		function uploadImg() {
			_webapp.uploadImg ();
		}
 		
//      function uploadImg() {
//			console.log("uploadImg")
// 			if (mui.os.plus) { 
//              var a = [{ 
//                  title: "拍照" 
//              }, { 
//                  title: "从手机相册选择" 
//              }]; 
//              plus.nativeUI.actionSheet({ 
//                  title: "修改用户头像", 
//                  cancel: "取消", 
//                  buttons: a 
//              }, function(b) { /*actionSheet 按钮点击事件*/ 
//                  switch (b.index) { 
//                      case 0: 
//                          break; 
//                      case 1: 
//                          getImage(); /*拍照*/ 
//                          break; 
//                      case 2: 
//                          galleryImg();/*打开相册*/ 
//                          break; 
//                      default: 
//                          break; 
//                  } 
//              }) 
//          } 
//      }
//      
//      
//      
//      function getImage() { 
//          var c = plus.camera.getCamera(); 
//          c.captureImage(function(e) { 
//              plus.io.resolveLocalFileSystemURL(e, function(entry) { 
//              	var path = entry.toLocalURL(); 
//                  $(".uploadImg").src = path; 
//                  var s = entry.toLocalURL() + "?version=" + new Date().getTime(); 
//                  uploadHead(s); /*上传图片*/ 
//              }, function(e) { 
//                  console.log("读取拍照文件错误：" + e.message); 
//              }); 
//          }, function(s) { 
//              console.log("error" + s); 
//          }, { 
//              filename: "_doc/head.png" 
//          }) 
//      }
//      function galleryImg() {
//          plus.gallery.pick(function(a) { 
//              plus.io.resolveLocalFileSystemURL(a, function(entry) { 
//                  plus.io.resolveLocalFileSystemURL("_doc/", function(root) { 
//                      root.getFile("head.png", {}, function(file) { 
//                          //文件已存在 
//                          file.remove(function() { 
//                              console.log("file remove success"); 
//                              entry.copyTo(root, 'head.png', function(e) { 
//                              		$(".uploadImg").src = path;
//                                      var e = e.fullPath + "?version=" + new Date().getTime(); 
//                                      uploadHead(e); /*上传图片*/ 
//                                      //变更大图预览的src 
//                                      //目前仅有一张图片，暂时如此处理，后续需要通过标准组件实现 
//                                  }, 
//                                  function(e) { 
//                                      console.log('copy image fail:' + e.message); 
//                                  }); 
//                          }, function() { 
//                              console.log("delete image fail:" + e.message); 
//                          }); 
//                      }, function() { 
//                          //文件不存在 
//                          entry.copyTo(root, 'head.png', function(e) { 
//                          		$(".uploadImg").src = path;
//                                  var path = e.fullPath + "?version=" + new Date().getTime(); 
//                                  uploadHead(path); /*上传图片*/ 
//                              }, 
//                              function(e) { 
//                                  console.log('copy image fail:' + e.message); 
//                              }); 
//                      }); 
//                  }, function(e) { 
//                      console.log("get _www folder fail"); 
//                  }) 
//              }, function(e) { 
//                  console.log("读取拍照文件错误：" + e.message); 
//              }); 
//          }, function(a) {}, { 
//              filter: "image" 
//          }) 
//      }; 
//      function getBase64Image(img) { 
//          var canvas = document.createElement("canvas"); 
//          var width = img.width; 
//          var height = img.height; 
//          // calculate the width and height, constraining the proportions 
//          if (width > height) { 
//              if (width > 100) { 
//                  height = Math.round(height *= 100 / width); 
//                  width = 100; 
//              } 
//          } else { 
//              if (height > 100) { 
//                  width = Math.round(width *= 100 / height); 
//                  height = 100; 
//              } 
//          } 
//          canvas.width = width;   /*设置新的图片的宽度*/ 
//          canvas.height = height; /*设置新的图片的长度*/ 
//          var ctx = canvas.getContext("2d"); 
//          ctx.drawImage(img, 0, 0, width, height); /*绘图*/ 
//          var dataURL = canvas.toDataURL("image/png", 0.8); 
//          return dataURL.replace("data:image/png;base64,", ""); 
//      }    
	</script>
</html>
