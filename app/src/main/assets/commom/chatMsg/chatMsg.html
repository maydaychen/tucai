<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>聊天</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../static/css/mui.min.css">
    <link rel="stylesheet" href="../../static/css/public.css">
    <link rel="stylesheet" href="../../static/fonts/iconfont.css">
    <link rel="stylesheet" href="../../static/css/iconfont.css">
    <link rel="stylesheet" href="../../static/css/deliver.css">
    <link rel="stylesheet" href="../../static/css/home.css">
    <style type="text/css">
        .mui-scroll-wrapper{
            margin-top: 45px;
        }
        .mui-table-view{
            margin-bottom:50px;
        }
        .mui-media-body h2{
            line-height:.6rem;
            width:5rem;
        }
        .barTxt{
            padding-bottom:9px
         }
        /* 头像 */
        .mui-table-view .mui-media-object.mui-pull-left {
            border-radius: 50%;
            margin-top: 4px;
            width:1.2rem;
            height:1.2rem;
        }
        .mui-table-view .mui-table-view-cell>a{
            height:2rem;
        }
        .mui-table-view-cell{
            height:2rem;
        }
        #pushrefresh2 .mui-scroll{
            margin-top:40px;
        }
    </style>
</head>

<body>
<header class="titleBar">
    <a class="barLeft iconfont mui-action-back"></a>
    <p class="barTab">
        <a class="btActive" data-code="0">聊天</a>
        <a data-code="1">通知</a>
    </p>
    <p class="barRight">
        <a class="br"></a>
    </p>
</header>

<div class="msg_container" style="position:absolute;top:0;width:100%;margin-top:45px;height:40px;display:none">
    <ul class="flex">
        <li><span class="active">公告通知</span></li>
        <li><span>谁看过我</span></li>
        <li><span>消息提示</span></li>
    </ul>
</div>

<div id="pullrefresh" class="mui-scroll-wrapper mui-content" style="background: #f6f6f6;">
    <div class="mui-scroll">
        <ul class="mui-table-view" id="chatList">
            <li class="mui-table-view-cell mui-media" v-for="item in chatList" v-show="show==true">
                <i class="chat_time" v-text="item.addtime"></i>
                <a data-href="chatPersonal.html" :data-chatno="item.chatno">
                    <img class="mui-media-object mui-pull-left" src="../../static/images/touxiang.jpg">
                    <div class="mui-media-body">
                        <h2 v-text="item.fromuid"></h2>
                        <p class='mui-ellipsis' v-text="item.message"></p>
                    </div>
                </a>
            </li>
        </ul>
    </div>
</div>
<div id="pushrefresh2" class="mui-scroll-wrapper mui-content" style="background: #f6f6f6;">
    <div class="mui-scroll">
        <div class="chat_message"  id="msgList">
            <div class="msg_info">
                <div class="msg_first msg" data-code="0" style="display:none">
                    <ul class="mui-table-view msgUl " id="ntcList" >
                            <li class="mui-table-view-cell mui-media msgLi" v-for="item in ntcList" v-show="show==true">
                                <span class="chat_time" v-text="item.addtime"></span>
                                <a data-href="../wiki/artical.html">
                                    <img class="mui-media-object mui-pull-left" src="../../static/images/touxiang.jpg">
                                    <div class="mui-media-body mui-ellipsis">
                                        <h2 class='mui-ellipsis' style="width:5.5rem" v-text="item.title"></h2>
                                        <p class='mui-ellipsis'>找工作时必读的安全小贴士！</p>
                                    </div>
                                </a>
                            </li>
                    </ul>
                </div>
                <div class="msg_second msg" style="display: none" data-code="1">
                    <ul class="mui-table-view" id="seeLists">
                        <li class="mui-table-view-cell mui-media" v-for="item in seeList" >
                            <span class="chat_time" v-text="item.addtime"></span>
                            <a data-href="../wiki/artical.html">
                                <img class="mui-media-object mui-pull-left" :src="item.logo">
                                <div class="mui-media-body">
                                    <h2 v-text="item.companyname"></h2>
                                    <p>
                                        <span style="color:#5A5A5A">招聘</span>
                                        <span v-text="item.jobs_name[0].jobs_name"></span>
                                    </p>
                                    <p class='mui-ellipsis'>
                                        <span v-text="item.trade_cn" style="color:#5A5A5A"></span>
                                        <span class="widther" style="color:#5A5A5A">|</span>
                                        <span v-text="item.scale_cn" style="color:#5A5A5A"></span>
                                    </p>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="msg_tips msg" style="display: none" data-code="2">
                    <ul class="mui-table-view" id="msgLists">
                            <li class="mui-table-view-cell mui-media" v-for="item in msgList" v-show="show=true">
                                <span class="chat_time" >哇哈哈</span>
                                <a data-href="../wiki/artical.html">
                                    <img class="mui-media-object mui-pull-left" src="../../static/images/touxiang.jpg">
                                    <div class="mui-media-body">
                                        <h2>刘七</h2>
                                        <p class='mui-ellipsis'>您好！刘七赞了你在涂才百科的评论</p>
                                    </div>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <!--底部导航-->
    </div>
</div>
<footer class="navBar">
    <ul>
        <li>
            <a data-href="../../index.html" >
                <i class="iconfont">&#xe60e;</i>
                <p>首页</p>
            </a>
        </li>
        <li>
            <a data-href="../discovery/discovery.html">
                <i class="iconfont">&#xe647;</i>
                <p>发现</p>
            </a>
        </li>
        <li>
            <a data-href="#" class="active">
                <i class="iconfont">&#xe60c;</i>
                <p>消息</p>
            </a>
        </li>
        <li>
            <a data-href="../../personal/personalCenter/personalCenter.html">
                <i class="iconfont">&#xe63d;</i>
                <p>我的</p>
            </a>
        </li>
    </ul>
</footer>
<script src="../../static/js/flexible.js" type="text/javascript" charset="utf-8"></script>
<script src="../../static/js/mui.min.js"></script>
<script src="../../static/js/update.js" type="text/javascript" charset="utf-8"></script>
<script src="../../static/js/jquery.js" type="text/javascript" charset="utf-8"></script>
<script src="../../static/js/tmodjs.js" type="text/javascript" charset="utf-8"></script>
<script src="../../static/js/fastclick.js" type="text/javascript" charset="utf-8"></script>
<script src="../../static/js/jquery.mockjax.js" type="text/javascript"></script>
<script src="../../static/js/vue.min.js"></script>
<script src="../../static/js/api.js"></script>
<script>
    var url=new GetRequest();
    var pageid=url.id;
    mui.init({
        statusBarBackground: '#41a6ff',
        swipeBack:true, //启用右滑关闭功能,
    });
    mui('.mui-scroll-wrapper').scroll({
        scrollY: true, //是否竖向滚动
        scrollX: false, //是否横向滚动
        startX: 0, //初始化时滚动至x
        startY: 0, //初始化时滚动至y
        indicators: true, //是否显示滚动条
        deceleration:0.0006, //阻尼系数,系数越小滑动越灵敏
        bounce: true //是否启用回弹
    });
    var chatListVue=new Vue({
        el:'#chatList',
        data:{
            chatList:null,
            show:false
        }
    });
    var msgListVue=new Vue({
        el:'#msgLists',
        data:{
            msgList:null,
            show:false
        }
    })
    var seeListVue=new Vue({
        el:'#seeLists',
        data:{
            seeList:null,

        }
    });
    var ntcListVue=new Vue({
        el:'#ntcList',
        data:{
            ntcList:null,
            show:false
        }
    })
    $(function(){

        loadNtcList();

        //loadNtcList();
//
        //loadSeeList();

        chatList();
    });
    //获取数据
    function loadMsgList(){
        var showMsg=host + "c=news&a=show_message_list";
        var page=1;
        var pagesize=10;
        var params={page:page,pagesize:pagesize};
        ajaxRun(showMsg,params,true,"POST",function(data){
            console.log(data);
            if(data.statuscode==1){
                msgListVue._data.msgList=data.result;
                msgListVue._data.show=true;
            }else{
                mui.toast(data.msg)
            }
        })
    }

    function loadNtcList(){
        var showNtc=host + "c=news&a=show_notice_list";
        var params={page:10,pagesize:10};
        ajaxRun(showNtc,params,true,"POST",function(data){
            console.log(data);
            if(data.statuscode==1){
               ntcListVue._data.ntcList=data.result;
               ntcListVue._data.show=true;
            }else{
                mui.toast(data.msg)
            }
        })
    }

    function loadSeeList(){
        var seeList=host + "c=personal&a=getSeeList";
        var params={page:1,pagesize:10};
        ajaxRun(seeList,params,true,"POST",function(data){
            console.log(data);
            if(data.statuscode==1){
                seeListVue._data.seeList=data.result;
            }else{
                mui.toast(data.msg)
            }
        })
    }
    //聊天
    function chatList(){
        //notice/getChatList
        var parmas={};
        var chatList=host+'c=notice&a=getChatList';
        ajaxRun(chatList,parmas,true,'POST',function (data) {
            console.log(data)
            if(data.statuscode==1){
                chatListVue._data.chatList=data.result;
                chatListVue._data.show=true;
            }else{
                mui.toast(data.msg)
            }
        })
    }

    $.each($('.barTab a'),function (index) {
        $('.barTab a').eq(index).click(function () {
            $('.barTab a').removeClass('btActive');
            $(this).addClass('btActive');
            if(utype==1){
                location.href='../../company/recruit/jobMsg.html?id='+pageid
            }else{
                var code=$(this).attr('data-code');
                if(code==0){
                    $('.msg_container').hide();
                    $('#pullrefresh').show();
                    $('#pullrefresh2').hide();
                    $('.msg').hide().parent().hide();
                }else{
                    $('.msg_container').show().css('z-index','101');
                    $('#pullrefresh').hide();
                   $('.msg_info').show();
                    $('#pullrefresh2').show();
                    $('.msg_first ').show();
                }
            }
        });
    });

    $(function(){
        $('.titleBar .barLeft').click(function(){
            // history.back() 或 history.go(-1)
            history.go(-1);
        })
    });

    //跳转到聊天对话页面
    $('#chatList').on('tap','a',function(){
        var href=$(this).attr('data-href');
        var chatno=$(this).attr('data-chatno');
        location.href=href+'?chatno='+chatno;
    })

    //
    $('.msg_container span').click(function(event){
        event.preventDefault();
        active=$(this);
        index= $('.msg_container span').index($(this));
        $(this).parent().siblings().children().removeClass('active');
        $(this).addClass('active');
        getShowHide(index);
        if(index==0){
            loadNtcList();
        }else if(index==1){
            loadSeeList()
        }else{
            loadMsgList();;
        }
    });
    function getShowHide(index){
        $('.msg').each(function(index1){
            if(index1==index){
                $(this).show().siblings().hide();
            }
        })
    }

    mui('.navBar').on('tap','a',function(){
        var url=$(this).attr('data-href');
        location.href=url;
    });
</script>
</body>

</html>