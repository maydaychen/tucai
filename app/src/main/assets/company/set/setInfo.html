<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>我的信息</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="yes" name="apple-touch-fullscreen" />
		<link rel="stylesheet" href="../../static/css/mui.min.css">
		<link rel="stylesheet" href="../../static/css/public.css">
		<link rel="stylesheet" href="../../static/css/iconfont.css">
		<link rel="stylesheet" href="../../static/fonts/iconfont.css">
		<link rel="stylesheet" href="../../static/css/home.css">
		<style type="text/css">
			.mBody{
				width: 100%;
				float: left;
				height: 100%
				overflow-y:auto;
				box-sizing: border-box;
				padding-top: 1rem;
			}
		 	.barRight {
		 		color: #fff;
	            font-size: .4rem;
	            padding: .2rem;
        	}
        	.img>img{
        	width: 1rem;
        	height: 1rem;
        	border-radius: 50%;
       		 }
		</style>
	</head>

	<body style="background: #f6f6f6;">
		<header class="titleBar">
			<a class="barLeft iconfont mui-action-back">&#xe604;</a>
			<p class="barTxt">我的信息</p>
			<span class="barRight">保存</span>
		</header>	
		
		<div class="mBody">
			<a class="cow changeImg">
				<h1>头像</h1>
				<span>
					<div class="img"><img id="headImg" src=""/></div>
					<i class="iconfont">&#xe649;</i>
				</span>
			</a>
			<div class="cowLine"></div>
			<a class="cow" id="box1">
				<h1>姓名</h1>
				<span>
					<p id="realName">哈哈哈</p>
					<i class="iconfont">&#xe649;</i>
				</span>
			</a>	
			<div class="cowLine"></div>
			<a class="cow mgt" id="box2">
				<h1>职位</h1>
				<span>
					<p id="job">HR</p>
					<i class="iconfont">&#xe649;</i>
				</span>
			</a>		
		</div>
		
		<!--<div class="fadeBottom"></div>
		<div class="lightBottom">
			<div class="lb">
				<i class="lbImg iconfont">&#xe7b6;</i>
				<p>拍摄照片</p>
			</div>
			<div class="lb">
				<i class="lbImg iconfont">&#xe7b7;</i>
				<p>相册照片</p>
				<input class="files" type="file" multiple="false" autocomplete="off" accept="image/jpg,image/jpeg,image/png,image/png" id="photo" value="" />
			</div>
			<a class="closeLb">取消</a>
		</div>-->
		
	</body>
		<script src="../../static/js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../static/js/flexible.js" type="text/javascript" charset="utf-8"></script>		
		<script src="../../static/js/mui.min.js"></script>
		<script src="../../static/js/malert.js" type="text/javascript" charset="utf-8"></script>	
		<script src="../../static/js/update.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../static/js/tmodjs.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../static/js/effect.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../static/js/fastclick.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../static/js/api.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../static/js/webapp.js"></script>
		<script>
			mui.init({
				statusBarBackground: '#41a6ff',
			});

			$(function(){
				FastClick.attach(document.body);
			});
		
		var save;
		var showPic;
        var savePics;
       $(".changeImg").on('tap',function(){
//    		pics=[];
			_webapp.uploadImg(function (res) {
				console.log(res);
				if(res.statusCode==0){
					save = res.data.save_path;
					showPic='http://tczp.wshoto.com/'+res.data.show_path;
					savePics='http://tczp.wshoto.com/'+res.data.save_path;
//					var html = "<img src=\"" + showPic + "\" />";
					$('#headImg').attr('src',showPic);
				}			
			})			
      	});
      	
//        上传头像
//		$(".titleBar").on('tap','span',function(){
//			console.log(save);
//			var param = {avatar: save,level: 2};
//          var getInfo = host + "c=upload&a=avatar";
//          ajaxRun(getInfo, param, true, 'GET', function (data) {
//              console.log(data);
//              if (data.statuscode == 1) {
//              	console.log(data.msg);
//              } else {
//              	console.log(data.msg);
//              }
//          });
//		})

		 	//    更换头像
//			var arrFiles = [];
//          $('.closeLb,.fadeBottom').on("tap", function () {
//              $('.lightBottom').fadeOutDown();
//              $('.fadeBottom').hide();
//          });
//          $('.changeImg').on("tap", function () {               
//              $('.lightBottom').show().fadeInUp();
//              $('.fadeBottom').show();
//          });
//          $("#photo").change(function () {
//              if (typeof (FileReader) != "undefined") {
//                  var regex = /(.jpg|.jpeg|.gif|.png|.bmp)$/;
//                  $($(this)[0].files).each(function () {
//                      var file = $(this);
////                      arrFiles.push(file);
//                      if (regex.test(file[0].name.toLowerCase())) {
//                          var reader = new FileReader();
//                          reader.onload = function (e) {
//                              var html = "<img src=\"" + e.target.result + "\" />";
//                              $('.img').append(html);
//                              $('.closeLb').click();
//                              arrFiles.push(reader.result);
//                              console.log(arrFiles)
//                          };
//                          reader.readAsDataURL(file[0]);
//                      }
//                      else {
//                          alert(file[0].name + "不是图片！");
//                          return false;
//                      }
//                  });
//              } else { alert("不支持"); }
//          });
            
            $('#box1').click(function(){	        	
		            $.malert({  
		                text: "输入真实姓名",  
		                cancle: function () {  
		                    console.log('关闭了')  
		                },  
		                ok: function () {  
		                	var str=$.trim($('#mInput').val());
		                	if(str==""||str.length>20){
		                		mui.toast('输入不正确！');
		                		return;
		                	}
		                    $('#realName').html(str).attr('data-val',str);		                  
		                }  
		            })  
		    }); 
	        $('#box2').click(function(){	        	
	            $.malert({  
	                text: "输入职位",  
	                cancle: function () {  
	                    console.log('关闭了')  
	                },  
	                ok: function () {  
	                	var str=$.trim($('#mInput').val());
	                	if(str==""||str.length>20){
	                		mui.toast('输入不正确！');
	                		return;
	                	}
	                    $('#job').html(str).attr('data-val',str);		                  
	                }  
	            })  
	        }); 
	        
	        
        function getInfo(){
            var url=host+"c=Personalinfo&a=show_personal_info";
            ajaxRun(url,{},true,'POST',function(data){
                console.log(data);
                if(data.statuscode==1){
                    var info = data.result;
                    $('#headImg').attr('src',info.avatars);
                    $('#realName').html(info.realname);                 
                    $('#job').html(info.work_type);
                }
            },1);
        }
        getInfo();
	        
	        
	        $('.titleBar').on('tap', 'span', function () {
	         	var userid = localStorage.getItem('userid');
	         	var realname=$("#realName").html();
	         	var work_type=$("#job").html();
	         	if(realname==''||work_type==''||save==''){
	         		 mui.alert('信息不完整');
	         	}else{
	         		var params = { op: 'edit', uid: userid, realname: realname,work_type:work_type,avatar: save,level: 2};
		        	var url=host + "c=Personalinfo&a=personal_info_update";
		        	ajaxRun(url, params, true, 'GET', function (data){
	        	 	if (data.statuscode == 1) {
                            mui.toast('更新信息成功！');
                            var param = {avatar: save,level: 2};
				            var getInfo = host + "c=upload&a=avatar";
				            ajaxRun(getInfo, param, true, 'GET', function (data) {
				                console.log(data);
				                if (data.statuscode == 1) {
				                	console.log(data.msg);
				                } else {
				                	console.log(data.msg);
				                }
				            });
                        } else {
                            mui.toast('更新信息失败！')
                        }	        	 	
	        	 	});
	         	}
	         })
	       

	  
	  
</script>
</html>